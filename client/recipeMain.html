<!DOCTYPE html>
<html lang="en">

<head>
    <title>Get This Tea DB</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/grid/">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <script type="text/babel">
        let pageSelected = '';
        let currentIngredientCount = 1;
        let currentIngredients = []

        //function to parse our response
        const parseJSON = (xhr, content) => {
            //parse response (obj will be empty in a 204 updated)
            const obj = JSON.parse(xhr.response);
            //console.dir(obj);

            //if message in response, add to screen
            if(obj.message) {
                const p = document.createElement('p');
                p.textContent = `Message: ${obj.message}`;
                content.appendChild(p);
            }

            //if users in response, add to screen
            if(obj.recipes) {
                const recipeList = document.createElement('p');
                
                for (let i = 0; i <= obj.recipeCount; i++){
                    let recipeBox = document.createElement('div');
                    let recipe = obj.recipes[i];
                    console.log(recipe);
                    recipeBox.setAttribute('class', "row themed-grid-col");
                    recipeBox.innerHTML += `<div class="col-md-6 themed-grid-col"><h2>Name: ${recipe.name}</h2></div>`;
                    recipeBox.innerHTML += `<div class="col-md-6 themed-grid-col"><h2>Taste: ${recipe.taste}</h2></div>`;
                    recipeBox.innerHTML += `<div class="col-md-6 themed-grid-col"><h2>Brew Time: ${recipe.brewTime}</h2></div>`;
                    let temp = `<div class="col-md-6 themed-grid-col"><h2>Ingredients:</h2>`;
                    for (let j = 0; j < Object.keys(recipe.ingredients).length; j++) {
                        temp += `<h3>${recipe.ingredients[j]}</h3>`;
                    }
                    temp += '</div>';
                    recipeBox.innerHTML += temp;
                    recipeBox.innerHTML += `</div>`;
                    content.appendChild(recipeBox);
                }                
                //recipeList.textContent = recipes;
            }
        };

        const handleResponse = (xhr) => {
          const content = document.querySelector('#content');

          //check the status code
          switch(xhr.status) {
            case 200: //success
              content.innerHTML = `<b>Success</b>`;
              break;
            case 201: //created
              content.innerHTML = '<b>Create</b>';
              break;
            case 204: //updated (no response back from server)
              content.innerHTML = '<b>Updated (No Content)</b>';
              return;
            case 400: //bad request
              content.innerHTML = `<b>Bad Request</b>`;
              break;
            case 404:
                content.innerHTML = `<b>Are you a Game Engine? Cause you UNREAL</b>`;
                  break;
            default: //any other status code
              content.innerHTML = `Error code not implemented by client.`;
              break;
          }
            
          if (xhr.response !== ""){
              console.log(JSON.parse(xhr.response));
              parseJSON(xhr, content);
          }
        };

        const getAjax = (getRecipeForm) => {
            
            //grab the form's name and age fields so we can check user input
            const url = getRecipeForm.querySelector('#urlField').value;
            const type = getRecipeForm.querySelector('#methodSelect').value;
            
            const xhr = new XMLHttpRequest(); 

            xhr.open(type, url);
            xhr.setRequestHeader ("Accept", 'type/JSON');    

            xhr.onload = () => handleResponse(xhr);

            xhr.send();

            //e.preventDefault();
            //return false to prevent the browser from trying to change page
            return false;
        };

        const init = () => {
            const getRecipeForm = document.querySelector('#getRecipeForm');
            
            //create handler
            const getRecipes = () => getAjax(getRecipeForm);
            getRecipes();

            //attach submit event (for clicking submit or hitting enter)
            //getRecipeForm.addEventListener('submit', getRecipes);
        };

        window.onload = init;

  </script>
</head>

<body class="py-4">
    <section id="top">
        <h3>Oh Yeah, It's All Coming Together</h3>


    </section>
    <div class="container">
        <a href='./createRecipe'><input id='createRecipe' type="submit" value="YOU BET I'M GONNA MAKE A TEA RECIPE" /></a>
        <form id="getRecipeForm" action="/getRecipess" method="get">
            <div class="row mb-3">
                <div class="col-md-4 themed-grid-col">
                    <select id='urlField'>
                        <option value='/getRecipes'>/getRecipes</option>
                        <option value='/notReal'>/notReal</option>
                    </select>
                </div>
                <div class="col-md-4 themed-grid-col">
                    <select id="methodSelect">
                        <option value="get">GET</option>
                        <option value="head">HEAD</option>
                    </select>
                </div>
                <div class="col-md-4 themed-grid-col">
                    <input type="submit" value="Get User" />
                </div>
            </div>
        </form>
        <section id="content">
    </section>
    </div>
</body>

</html>